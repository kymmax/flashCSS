/*!
 * flashCSS 2.0.0
 * 2023-11-08
 * https://github.com/kymmax/flashCSS
 * 
 * @license Copyright 2023, flashCSS. All rights reserved.
 * @author: Jason Kuo, kymmax0420@gmail.com
 * 
 * Licensed MIT
 */
export default function flashCSS(a={}){function b(a){let b=y.querySelectorAll(a),c=Array.from(b);return c}function c(a){if(a.flashID||A.test(a.tagName))return;const b=new Date().getTime()+z.length,c=new MutationObserver(function(a){a.forEach(function(a){"class"===a.attributeName&&(f.template(),f.init(a.target,!0))})});c.observe(a,{attributes:!0,attributeFilter:["class"]}),c.id=b,a.flashID=b,z.push(c)}function d(){const a=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&a.removedNodes.forEach(function(a){const b=a.flashID,c=z.findIndex(a=>a.id===1*b);-1!==c&&(z[c]?.disconnect(),z.splice(c,1),a.querySelectorAll("*").forEach(a=>{const b=a.flashID,c=z.findIndex(a=>a.id===1*b);z[c]?.disconnect(),z.splice(c,1)}))})})});a.observe(y,{childList:!0,subtree:!0})}function e(){const a=new MutationObserver(function(a){a.forEach(function(a){if("childList"===a.type)for(let b of a.addedNodes)b.nodeType!==Node.ELEMENT_NODE||A.test(b.tagName)||(f.template(),f.init(b,!0),c(b),b.querySelectorAll("*").forEach(a=>{A.test(a.tagName)||(f.init(a,!0),c(a))}))})});a.observe(y,{childList:!0,subtree:!0})}const f=this,g="css",h="flashCSS";let i={xs:0,sm:576,md:768,lg:992,xl:1280,landscape:"landscape",portrait:"portrait",...a.setMedia};const j=Object.keys(i).join("|"),k=new RegExp(`^(${j})$`,"g");let l={d:["display"],flexDir:["flex-direction"],justifyContent:["justify-content"],alignItems:["align-items"],alignSelf:["align-self"],justifyAlign:["justify-content","align-items"],flexWrap:["flex-wrap"],order:["order"],flex:["flex"],ps:["position"],w:["width"],h:["height"],wh:["width","height"],maxw:["max-width"],minw:["min-width"],maxh:["max-height"],minh:["min-height"],gTempCol:["grid-template-columns"],gAutoRow:["grid-auto-rows"],gColStart:["grid-column-start"],gColEnd:["grid-column-end"],gRowStart:["grid-row-start"],gRowEnd:["grid-row-end"],gColGap:["grid-column-gap"],gRowGap:["grid-row-gap"],colCount:["column-count"],colGap:["column-gap"],colSpan:["column-span"],rowGap:["row-gap"],g:["gap"],placeContent:["place-content"],placeItems:["place-items"],p:["padding"],pr:["padding-right"],pl:["padding-left"],pt:["padding-top"],pb:["padding-bottom"],px:["padding-left","padding-right"],py:["padding-top","padding-bottom"],m:["margin"],mr:["margin-right"],ml:["margin-left"],mt:["margin-top"],mb:["margin-bottom"],mx:["margin-left","margin-right"],my:["margin-top","margin-bottom"],at:["top"],ab:["bottom"],al:["left"],ar:["right"],fz:["font-size"],fl:["letter-spacing"],fh:["line-height"],fa:["text-align"],fw:["font-weight"],fd:["text-decoration"],fi:["text-indent"],ft:["text-transform"],br:["border"],bw:["border-width"],bc:["border-color"],bs:["border-style"],round:["border-radius"],sdb:["box-shadow"],sdt:["text-shadow"],color:["color"],filter:["filter"],blend:["mix-blend-mode"],bg:["background"],bgc:["background-color"],bgi:["background-image"],bgs:["background-size"],bgp:["background-position"],bgr:["background-repeat"],bgo:["background-origin"],ts:["transition"],tf:["transform"],tfStyle:["transform-style"],tfOrigin:["transform-origin"],float:["float"],o:["opacity"],ov:["overflow"],ws:["white-space"],z:["z-index"],objFit:["object-fit"],objPos:["object-position"],ani:["animation"],ratio:["aspect-ratio"],pointer:["pointer-events"],cursor:["cursor"],select:["user-select"],va:["vertical-align"],wm:["writing-mode"],content:["content"],...a.setStyle};Array.isArray(a.deleteStyle)&&a.deleteStyle.forEach(a=>{delete l[a]});const m=Object.keys(l).join("|"),n=new RegExp("^("+m+")$","g");let o={":":":","~":"~",".":".",neg:"-","@":"@","#":"#",$:"$","%":"%","^":"^","&":"&","*":"*","`":"`",_:" ",",":",","(":"(",")":")","{":"{","}":"}",">":">","<":"<","`":"`",";":";","'":"'","|":"|","/":"/","?":"?","!":" !important",...a.setSymbol};const p=Object.keys(o).map(a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"),q=new RegExp("("+p+")","g");let r={...a.setVariable};const s=Object.keys(r).map(a=>`\\$${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`).join("|"),t=new RegExp(`(${s})`,"g"),u=a.link?a.link:"-";let v="";const w=[],x={};Object.keys(i).forEach(function(a){x[a]=""}),this.init=function(b,c){let d=b.getAttribute("class");null==d||(d=d.split(" "),d.forEach(function(b){let d=b.replace(/\n/g,"");if(""===d)return;let e=[d],g="",h="",i=e[0].match(/\{([^}]+)\}/),j="";if(i){let a=i[1];e=a.split(";");let b=d.match(/^(.*?){[^}]+}(.*)$/m);b&&(g=b[1],h=b[2]),h[0]===u&&(j=h.split(u)[1],h=h.split(u)[2]||"")}let m=[],p=[],s=[],y=[],z=[],A=[],B=[],C=[];if(e.forEach(function(a,b){s[b]=!1;let c=a.split(u)[0],d=c.replace(n,function(a){return s[b]=!0,l[a]});if(!s.includes(!1)){m.push(c),p.push(d),y[b]=!1;let e=a.split(u)[1];if(e){let c=e.replace(k,function(a){return y[b]=!0,a});z.push(e),y[b]?(A.push(c),B.push(a.split(m[b]+u+A[b]+u)[1])):(A.push(k.test(j)?j:"origin"),B.push(a.split(m[b]+u)[1])),C=[...B]}}}),s.includes(!1))return;B=function(a){return a.forEach(function(b,c){a[c]=b.replace(q,function(a,b){return(0<b?"":"\\")+a})}),a}(B);let D=[],E=[];C=function(b){return b.forEach(function(c,d){let e=b[d];if(e=c.replace(q,function(a,b){return o[b]}),c.includes("rgba")&&c.includes("#")){let a=e.split("#")[1].substring(0,6),b=f.hexToRgb("#"+a);e=e.replace("#"+a,b.r+","+b.g+","+b.b)}if(a.setVariable&&(e=e.replace(t,function(a,b){return r[b.split("$")[1]]})),/:{2}/.test(c)){D.push(!0);let a=e.split(/(before|after|selection|first-letter|first-line)/),b=a[0]+a[1];E.push(b),e=e.split(b+u)[1]}else if(/:/.test(c)){D.push(!0);let a=e.split(/(nth-child\(\d+\)|nth-last-child\(\d+\)|first-child|last-child|hover|active|focus|checked|enabled|disabled|not|has|is|where)/),b=a[0]+a[1];E.push(b),e=e.split(b+u)[1]}else D.push(!1),E.push("");return a.setCustomVal&&(e=a.setCustomVal(e)),b[d]=e}),b}(C);let F=d.replace(q,function(a,b){return(0<b?"":"\\")+a});if(w.includes(F))return;w.push(F);let G={};(function(b){b.forEach(function(b,c){b.split(",").forEach(function(b){G[A[c]]||(G[A[c]]="");let d=A[c]?A[c]:"origin";G[d]+=b+": "+C[c],G[d]+=a.important?" !important;":";"})})})(p);let H={};return Object.keys(G).forEach(function(a){H[a]="",H[a]+="."+F,H[a]+=D[0]?E[0]:"",H[a]+=g?" "+g:g,H[a]+=h,H[a]+="{",H[a]+=G[a],H[a]+="}"}),c?f.update(A,H):void function(){Object.keys(H).forEach(function(a){"origin"===a?v+=H[a]:x[a]+=H[a]})}()}))};let y=document.querySelector(a.target?a.target:"body"),z=[];const A=/^(head|meta|link|title|option|script|noscript|style)$/i;this.addMedia=function(){Object.keys(x).forEach(function(a){switch(!0){case"landscape"===a||"portrait"===a:v+="@media (orientation:"+i[a]+") {"+x[a]+"} ";break;default:v+="@media (min-width:"+i[a]+"px) {"+x[a]+"} ";}})},this.update=function(b,c){const d=document.querySelectorAll(`style[data-${g}=${h}]`)[0];Object.keys(c).forEach(function(a){let b=d.textContent.split(i[a]+"px) {");d.textContent="origin"===a?[c[a],d.textContent].join(" "):b[0]+i[a]+"px) {"+c[a]+b[1]}),a.onCompleted&&a.onCompleted()},this.addTag=function(){if(!document.querySelector(`[data-${g}=${h}]`)){const b=document.createElement("style");b.type="text/css",b.setAttribute(`data-${g}`,h),b.appendChild(document.createTextNode(v));const c=document.getElementsByTagName(a.style?a.style:"head")[0];c.appendChild(b),a.onCompleted&&a.onCompleted()}},this.observer=function(){a.observeDOM||(b("*").forEach(function(a){c(a)}),d())},this.observerDOM=function(){e(),b("*").forEach(function(a){c(a)}),d()},this.hexToRgb=function(a){let b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},this.copy=function(a){let c=a.getAttribute("class");if(null!==c){let d=c.split(" ");d.forEach(function(d){if(d.match(/^@/g)){let e=d.split("@")[1],f=c.replace(d,"");a.setAttribute("class",f);let g=b(".\\="+e);g.forEach(function(a){let b=a.getAttribute("class"),c=b.replace("="+e,f);a.setAttribute("class",c)})}})}},this.template=function(){a.setTemplate&&Object.keys(a.setTemplate).forEach(function(c){b(".\\="+c).forEach(function(b){let d=b.getAttribute("class");if(null!==d){let e=d.replace("="+c,a.setTemplate[c]);b.setAttribute("class",e)}})})},this.refresh=function(){f.template(),b("[class]").forEach(function(a){f.copy(a),f.init(a,!0)})},f.template(),b("[class]").forEach(function(a){f.copy(a),f.init(a)}),this.addMedia(),this.addTag(),!0===a.observe&&this.observer(),!0===a.observeDOM&&this.observerDOM(),!0===a.showPara&&console.table(l),!0===a.showMedia&&console.table(i),!0===a.showVariable&&console.table(r)}